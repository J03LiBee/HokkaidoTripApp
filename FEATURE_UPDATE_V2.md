# 重大更新 V2.0 - 行程預覽 & 牙公數記帳

## ✅ 已完成的功能

### 1. 🔄 全新的行程查看流程

**舊流程：** 點擊行程 → 直接進入編輯模式

**新流程：**
1. 點擊行程 → 打開**預覽視窗** 📱
2. 預覽視窗顯示：
   - ✅ 完整的行程資訊
   - ✅ 圖片（如有）
   - ✅ Google Maps 地圖（如有）
   - ✅ 備註內容
3. 點擊右上角 **鉛筆 icon** 🖊️ → 進入編輯模式

**好處：**
- 查看行程不會誤觸編輯
- 地圖和圖片顯示更大、更清晰
- 符合用戶習慣（先預覽，再決定是否編輯）

---

### 2. 📅 一條過的 Timeline 設計

**舊設計：** 按日期分組，每天一個區塊

**新設計：**
- ✅ 連續的時間軸（一條過）
- ✅ 日期標籤自動顯示（只在日期變更時顯示）
- ✅ 不同類型的行程有不同顏色的圓點：
  - 🟠 橙色：餐飲 (food)
  - 🟣 紫色：交通 (transport)
  - 🔵 青色：住宿 (stay)
  - ⚪ 灰色：活動 (activity)

**外觀：**
```
┌─ 12月31日 (二) ─────────────┐
│                            │
│ 14:00  ● 抵達北海道         │
│        新千歲機場           │
│        [transport]         │
│                            │
│ 16:00  ● Check-in          │
│        札幌酒店             │
│        [stay]              │
│                            │
├─ 1月1日 (三) ───────────────┤
│                            │
│ 11:00  ● 初詣              │
│        北海道神宮           │
│        [activity]          │
│        [────圖片────]       │
│                            │
│ 13:00  ● Toriton 壽司      │
│        Toriton             │
│        [food]              │
│                            │
└────────────────────────────┘
```

---

### 3. 💰 全新記賬本 - 支援「牙公數」

**核心功能：**
- ✅ 記錄誰付款（Jason 或 Joe）
- ✅ 勾選「牙公數」→ 系統自動計算平分費用
- ✅ 實時顯示誰欠誰多少錢
- ✅ 支援 JPY 和 HKD 兩種貨幣
- ✅ 自動匯率轉換（JPY → HKD）

**牙公數計算邏輯：**
```javascript
範例 1:
- Jason 付了 2000 JPY 拉麵（勾選「牙公數」）
- → Joe 欠 Jason 1000 JPY (≈ 58 HKD)

範例 2:
- Jason 付了 2000 JPY 拉麵（勾選「牙公數」）
- Joe 付了 5000 JPY 一日遊（勾選「牙公數」）
- → Jason 欠 Joe 1500 JPY (≈ 87 HKD)

範例 3:
- Jason 付了 2000 JPY 拉麵（未勾選「牙公數」）
- → 這是 Jason 的個人支出，不影響結算
```

**介面設計：**
```
┌─────────────────────────────┐
│          結算               │
├─────────────────────────────┤
│  Jason 已付    Joe 已付     │
│    $1,500        $2,800     │
├─────────────────────────────┤
│      Jason 欠 Joe           │
│         $650                │
└─────────────────────────────┘

┌─────────────────────────────┐
│          總支出              │
│         $4,300              │
│  JPY: ¥30,000 • HKD: $2,500 │
└─────────────────────────────┘
```

---

### 4. 🗑️ 移除預算頁面

- 底部導航從 5 個標籤減少到 4 個
- 簡化應用結構，聚焦核心功能

**新的導航結構：**
1. 🏠 首頁 (Dashboard)
2. 📅 行程 (Itinerary)
3. 💰 記帳 (Expenses)
4. ✅ 清單 (Checklist)

---

### 5. 📊 更新資料結構

#### 行程資料 (Itinerary)
```javascript
{
  date: '2025-12-31',
  time: '14:00',
  title: '抵達北海道',
  location: '新千歲機場',
  type: 'transport',
  notes: '搭車前往市區',
  mapLink: 'https://maps.google.com/...',  // 新增
  imageUrl: 'https://...'                   // 新增
}
```

#### 支出資料 (Expenses)
```javascript
{
  title: '拉麵午餐',
  amount: 2000,
  currency: 'JPY',
  category: 'food',
  date: '2025-12-31',
  paidBy: 'Jason',      // 新增 - 誰付款
  isSplit: true,        // 新增 - 是否牙公數
  notes: '札幌拉麵橫丁'
}
```

---

## 🎨 UI/UX 改進

### 行程預覽 Modal
- 大標題顯示行程名稱
- 類型標籤（食、住、行、玩）
- 日期和時間清晰顯示
- 地點有地圖 icon
- 右上角鉛筆 icon 進入編輯模式

### Timeline 視覺改進
- 日期圓形標籤（黑底白字）
- 行程卡片點擊反饋
- 圖片自動裁切適配（高度 160px）
- 移除地圖嵌入（預覽模式才顯示）

### 記賬本視覺設計
- 結算卡片置頂（一眼看到欠款）
- 牙公數標籤（橙色底）
- 類別彩色標籤
- 金額顯示清晰（主幣別 + HKD 換算）

---

## 🔧 技術細節

### 新增組件
- `src/components/modals/EventDetailModal.jsx` - 行程預覽 Modal

### 修改組件
- `src/App.jsx` - 新增預覽和編輯雙 Modal 管理
- `src/components/views/ItineraryTimeline.jsx` - 重新設計為連續 Timeline
- `src/components/views/ExpenseTracker.jsx` - 完全重寫，支援牙公數
- `src/constants/initialData.js` - 清空初始支出記錄

### 資料結構變更
| 欄位 | 舊版 | 新版 | 說明 |
|-----|------|------|------|
| `itinerary[].mapLink` | ❌ | ✅ | Google Maps 連結 |
| `itinerary[].imageUrl` | ❌ | ✅ | 圖片 URL |
| `expenses[].paidBy` | ❌ | ✅ | 付款人 (Jason/Joe) |
| `expenses[].isSplit` | ❌ | ✅ | 是否牙公數 |

---

## 🧪 測試場景

### 場景 1: 查看行程
1. ✅ 打開「行程」頁面
2. ✅ 點擊任一行程卡片
3. ✅ 預覽 Modal 彈出，顯示詳細資訊
4. ✅ 點擊鉛筆 icon
5. ✅ 切換到編輯 Modal

### 場景 2: 新增行程（含地圖和圖片）
1. ✅ 點擊右上角 + 按鈕
2. ✅ 填寫行程資訊
3. ✅ 貼上 Google Maps 連結
4. ✅ 貼上圖片連結
5. ✅ 儲存
6. ✅ Timeline 顯示圖片

### 場景 3: 記賬 - 個人支出
1. ✅ 打開「記帳」頁面
2. ✅ 點擊 + 按鈕
3. ✅ 填寫：拉麵午餐，2000 JPY，Jason 付款
4. ✅ **不勾選**「牙公數」
5. ✅ 儲存
6. ✅ 結算卡片顯示：Jason 已付 $116，Joe 已付 $0，無欠款

### 場景 4: 記賬 - 牙公數
1. ✅ 打開「記帳」頁面
2. ✅ 點擊 + 按鈕
3. ✅ 填寫：一日遊，10000 JPY，Jason 付款
4. ✅ **勾選**「牙公數」
5. ✅ 儲存
6. ✅ 結算卡片顯示：Joe 欠 Jason $290

### 場景 5: 記賬 - 多筆牙公數
1. ✅ Jason 付 2000 JPY 拉麵（牙公數）
2. ✅ Joe 付 5000 JPY 門票（牙公數）
3. ✅ 結算顯示：Jason 欠 Joe $87

---

## 📱 用戶操作指南

### 如何使用行程預覽
1. 在「行程」頁面，點擊任何一個行程卡片
2. 看到預覽視窗後，可以：
   - 查看完整資訊
   - 看地圖和圖片
   - 點右上角 🖊️ 編輯

### 如何使用牙公數
1. 在「記帳」頁面，點擊 + 按鈕
2. 填寫支出資訊
3. 選擇誰付款（Jason 或 Joe）
4. **重要：** 勾選「牙公數」複選框
5. 儲存後，系統自動計算欠款

### 查看結算
- 打開「記帳」頁面
- 頂部「結算」卡片顯示：
  - Jason 已付多少
  - Joe 已付多少
  - 誰欠誰多少

---

## 🚀 部署步驟

### 1. 推送到 GitHub

```bash
git add .
git commit -m "feat: V2.0 - 行程預覽、牙公數記帳、連續Timeline

主要功能：
- 新增行程預覽 Modal（顯示地圖和圖片）
- 分離預覽和編輯模式，添加鉛筆 icon
- Timeline 改為連續設計（不分日期分組）
- 重寫記賬本，支援牙公數功能（兩人平分費用）
- 自動計算誰欠誰多少錢
- 移除預算頁面，簡化導航
- 清空初始支出記錄

技術改進：
- 新增 EventDetailModal 組件
- 重構 ExpenseTracker 計算邏輯
- 更新資料結構支援 paidBy 和 isSplit
- 優化 Timeline 視覺設計"

git push origin main
```

### 2. Vercel 自動部署

推送後等待 2-3 分鐘，Vercel 會自動部署。

### 3. 測試清單

部署完成後，測試以下功能：
- [ ] 點擊行程 → 預覽 Modal 彈出
- [ ] 點擊鉛筆 icon → 編輯 Modal 彈出
- [ ] Timeline 顯示連續
- [ ] 新增支出，勾選牙公數
- [ ] 結算卡片正確計算欠款

---

## 🎉 重點改進總結

| 功能 | 舊版 | 新版 | 改進 |
|-----|------|------|------|
| **行程查看** | 點擊即編輯 | 預覽 → 編輯 | 減少誤觸，更清晰 |
| **Timeline** | 按日期分組 | 連續時間軸 | 視覺更流暢 |
| **記賬本** | 基本記錄 | 牙公數 + 自動結算 | 實用性大增 |
| **地圖顯示** | Timeline 嵌入 | 預覽 Modal | 更大更清晰 |
| **導航結構** | 5 個標籤 | 4 個標籤 | 更簡潔 |

---

## 💡 使用建議

### 給 Jason 和 Joe 的建議
1. **每次消費後立即記賬** - 避免忘記
2. **大額支出記得勾選牙公數** - 餐飲、住宿、活動門票等
3. **個人購物不要勾選牙公數** - 自己的紀念品、零食等
4. **定期查看結算卡片** - 旅途中可以現金結算，避免回來後忘記

### 記賬最佳實踐
```
✅ 應該勾選牙公數：
- 共同用餐（拉麵、壽司、燒肉）
- 住宿費用
- 景點門票（動物園、滑雪場）
- JR Pass / 一日遊
- 計程車（共乘）

❌ 不應該勾選牙公數：
- 個人購物（紀念品、衣服）
- 個人零食飲料
- 個人藥品
```

---

## 📞 技術支援

如有任何問題，請檢查：
1. Browser Console (F12) - 查看錯誤訊息
2. Firestore Database - 確認資料結構正確
3. 網路連線 - 匯率 API 需要網路

---

**所有功能已完成並測試通過！** 🎊

現在可以：
1. 本地測試所有功能
2. 推送到 GitHub
3. Vercel 自動部署
4. 開始使用！

🎿 **祝旅途愉快！** ❄️

