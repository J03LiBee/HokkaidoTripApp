# 🧪 測試指南 - V2.0 新功能

## 🌐 開發服務器

```bash
✅ 正在運行: http://localhost:3001
```

---

## ✅ 測試清單

### 1. 行程預覽功能

#### 測試步驟：
1. 打開 http://localhost:3001
2. 登入（Google 或 Guest）
3. 點擊底部「行程」標籤
4. **點擊任何一個行程卡片**

**預期結果：**
- ✅ 彈出預覽 Modal
- ✅ 顯示行程標題
- ✅ 顯示日期、時間、地點
- ✅ 顯示類型標籤（食、住、行、玩）
- ✅ 右上角有鉛筆 icon 🖊️

#### 進入編輯模式：
5. 點擊右上角的**鉛筆 icon**

**預期結果：**
- ✅ 預覽 Modal 關閉
- ✅ 編輯 Modal 打開
- ✅ 所有欄位已填入現有資料
- ✅ 可以修改資料

---

### 2. 新增行程（含地圖和圖片）

#### 測試步驟：
1. 在「行程」頁面
2. 點擊右上角 **+ 按鈕**
3. 填寫資料：
   - 日期：2026-01-02
   - 時間：10:00
   - 標題：札幌電視塔
   - 地點：札幌
   - 類型：活動

4. 添加 Google Maps：
   - 打開 Google Maps
   - 搜尋「札幌電視塔」
   - 點擊「分享」→ 複製連結
   - 貼上到「Google Maps 連結」欄位

5. 添加圖片：
   - 使用測試圖片 URL：
     ```
     https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=800
     ```
   - 貼上到「圖片連結」欄位

6. 點擊「儲存」

**預期結果：**
- ✅ Modal 關閉
- ✅ Timeline 顯示新行程
- ✅ 行程卡片顯示圖片
- ✅ 點擊卡片 → 預覽 Modal 顯示地圖和圖片

---

### 3. 連續 Timeline 設計

#### 檢查項目：
1. 打開「行程」頁面
2. 查看 Timeline

**預期結果：**
- ✅ 一條連續的垂直線
- ✅ 每天第一個行程前有日期標籤（例如：12月31日 (二)）
- ✅ 同一天的行程不重複顯示日期
- ✅ 每個行程有顏色的圓點：
  - 🟠 橙色 = 餐飲
  - 🟣 紫色 = 交通
  - 🔵 青色 = 住宿
  - ⚪ 灰色 = 活動

---

### 4. 記賬本 - 個人支出

#### 測試步驟：
1. 點擊底部「記帳」標籤
2. 點擊 **+ 按鈕**
3. 填寫：
   - 項目：便利店零食
   - 金額：500
   - 貨幣：JPY
   - 類別：購物
   - 付款人：Jason
   - **不勾選**「牙公數」
4. 點擊「新增記錄」

**預期結果：**
- ✅ 支出列表顯示新記錄
- ✅ 結算卡片：
  - Jason 已付：約 $29
  - Joe 已付：$0
  - **無欠款提示**（因為沒勾選牙公數）

---

### 5. 記賬本 - 牙公數（單筆）

#### 測試步驟：
1. 在「記帳」頁面
2. 點擊 **+ 按鈕**
3. 填寫：
   - 項目：拉麵午餐
   - 金額：2000
   - 貨幣：JPY
   - 類別：餐飲
   - 付款人：Jason
   - ✅ **勾選**「牙公數」
4. 點擊「新增記錄」

**預期結果：**
- ✅ 支出列表顯示新記錄
- ✅ 記錄右邊有「牙公數」橙色標籤
- ✅ 結算卡片：
  - Jason 已付：約 $145
  - Joe 已付：$0
  - **Joe 欠 Jason：約 $58**（2000 JPY 的一半）

---

### 6. 記賬本 - 牙公數（多筆交錯）

#### 測試步驟：
1. 繼續在「記帳」頁面
2. 新增第二筆：
   - 項目：動物園門票
   - 金額：5000
   - 貨幣：JPY
   - 類別：活動
   - 付款人：**Joe**
   - ✅ **勾選**「牙公數」
3. 點擊「新增記錄」

**預期結果：**
- ✅ 結算卡片更新：
  - Jason 已付：約 $145
  - Joe 已付：約 $290
  - **Jason 欠 Joe：約 $87**
    - 計算：Joe 付 5000，應收回 2500
    - Jason 付 2000，應收回 1000
    - 差額：2500 - 1000 = 1500 JPY ≈ $87

---

### 7. 貨幣轉換測試

#### 測試步驟：
1. 在「記帳」頁面
2. 新增 HKD 支出：
   - 項目：機場快線
   - 金額：100
   - 貨幣：**HKD**
   - 類別：交通
   - 付款人：Jason
   - ✅ 勾選「牙公數」

**預期結果：**
- ✅ 總支出同時顯示 JPY 和 HKD
- ✅ 結算正確計算（HKD 和 JPY 混合）
- ✅ 匯率資訊顯示在底部

---

### 8. 多用戶同步測試（需要兩台設備或兩個瀏覽器）

#### 測試步驟：
1. **設備 A**（Chrome）：用 Google 帳號 A 登入
2. **設備 B**（Firefox）：用 Google 帳號 B 登入
3. **設備 A**：新增一個行程
4. **設備 B**：查看行程頁面

**預期結果：**
- ✅ 設備 B **即時**看到設備 A 新增的行程

5. **設備 A**：新增一筆支出（勾選牙公數）
6. **設備 B**：查看記賬頁面

**預期結果：**
- ✅ 設備 B **即時**看到設備 A 新增的支出
- ✅ 結算卡片同步更新

---

## 🐛 已知問題和注意事項

### 1. Google Maps API Key
- 需要在 Google Cloud Console 啟用 **Maps Embed API**
- 如果地圖不顯示，請檢查：
  1. API Key 是否有效
  2. Maps Embed API 是否已啟用
  3. API Key 是否有流量限制

### 2. 圖片連結
- 必須是直接圖片 URL（.jpg, .png, .gif）
- 不支援 Google Drive / Dropbox 分享連結
- 推薦使用：
  - Imgur: https://imgur.com/
  - Unsplash: https://unsplash.com/
  - ImgBB: https://imgbb.com/

### 3. 舊資料
- 如果有舊的支出記錄，可能缺少 `paidBy` 和 `isSplit` 欄位
- 這些記錄不會影響結算（因為沒有 `isSplit`）
- 建議：清空舊資料重新開始

---

## 🔍 除錯技巧

### 查看 Console 錯誤
1. 按 **F12** 打開開發者工具
2. 切換到 **Console** 標籤
3. 查看是否有紅色錯誤訊息

### 查看 Firestore 資料
1. 打開 [Firebase Console](https://console.firebase.google.com/)
2. 選擇專案 `hokkaidowebapp`
3. 左側選單 → **Firestore Database**
4. 查看資料結構：
   ```
   /trips/hokkaido-2025/
     ├── itinerary/     (行程 - 共享)
     ├── expenses/      (支出 - 共享)
     └── budget/        (預算 - 共享)
   
   /artifacts/hokkaido-2025-v2/users/{userId}/
     └── checklist/     (清單 - 個人)
   ```

### 清除快取
如果遇到奇怪的問題：
1. **Chrome**: Ctrl+Shift+Delete → 清除快取
2. 或使用無痕模式測試

---

## ✅ 測試檢查表

完成以下測試後打勾：

### 行程功能
- [ ] 點擊行程 → 預覽 Modal 顯示
- [ ] 點擊鉛筆 → 編輯 Modal 顯示
- [ ] 新增行程（含地圖和圖片）
- [ ] Timeline 顯示連續設計
- [ ] 日期標籤正確顯示
- [ ] 圖片在卡片中顯示

### 記賬功能
- [ ] 新增個人支出（無欠款）
- [ ] 新增牙公數支出（Jason 付）
- [ ] 新增牙公數支出（Joe 付）
- [ ] 結算卡片正確計算
- [ ] 支援 JPY 和 HKD
- [ ] 匯率自動轉換

### 多用戶同步
- [ ] 兩個設備同時登入
- [ ] 一個設備新增行程 → 另一個即時看到
- [ ] 一個設備新增支出 → 另一個即時看到

### 視覺設計
- [ ] 雪花效果正常
- [ ] Glassmorphism 效果正常
- [ ] 按鈕顏色清晰可見
- [ ] 手機瀏覽器正常顯示

---

## 🎉 測試完成

如果所有測試都通過，可以：
1. ✅ 推送到 GitHub
2. ✅ Vercel 自動部署
3. ✅ 開始使用！

---

## 📞 需要幫助？

如果測試遇到問題，請檢查：
1. Browser Console (F12) - 錯誤訊息
2. Network 標籤 - API 請求是否成功
3. Firestore Database - 資料是否正確寫入
4. Firebase Rules - 是否已更新

**所有功能已完成，準備測試！** 🚀

